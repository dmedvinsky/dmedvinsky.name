<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Salt Stack</title>
    <meta name="description" content="About Salt Stack for corporate junkies.">
    <meta name="author" content="Dmitry Medvinsky">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <link rel="stylesheet" href="../lib/reveal.js/css/reveal.css">
    <link rel="stylesheet" href="../lib/reveal.js/css/theme/default.css">
    <link rel="stylesheet" href="../lib/reveal.js/lib/css/zenburn.css">
    <link rel="stylesheet" href="css/custom.css">
  </head>

  <body>
    <div class="reveal">
      <div class="slides">

<section>
  <h1>SaltStack</h1>
  <address class="author vcard">
    <p class="name">Dmitry Medvinsky</p>
    <p class="email"><a href="mailto:me@dmedvinsky.name">me@dmedvinsky.name</a></p>
  </address>
</section>

<section>
  <h2>SaltStack</h2>
  <ul>
    <li>Remote execution</li>
    <li>Server configuration manager</li>
    <li>With cloud in mind, but works in any setup</li>
  </ul>
</section>

<section>
  <h2>Why not Puppet, Chef?</h2>
  <ul>
    <li>Python</li>
    <li>Jinja Templates (by default)</li>
    <li>YAML state files</li>
    <li>Minimalistic, clean codebase</li>
  </ul>
</section>

<section>
  <h2>Cons</h2>
  <ul>
    <li>Pretty young</li>
    <li>Smaller community</li>
    <li>Less modules</li>
  </ul>
</section>

<section>
  <h2>Architecture</h2>
  <ul>
    <li>salt-master</li>
    <li>salt-minion</li>
  </ul>
</section>

<section>
  <h2>Main terms</h2>
  <ul>
    <li>Targeting</li>
    <li>Remote Execution</li>
    <li>Configuration Management</li>
  </ul>
</section>

<section>
  <h2>Minion targeting</h2>
  <ul>
    <li>Hostname (Globs/RegEx)</li>
    <li>Grains (RegEx)</li>
    <li>Static groups</li>
    <li>Compound</li>
  </ul>
</section>

<section>
  <h2>Grains</h2>
  <h3>Targeting</h3>
  <ul>
    <li>os:CentOS</li>
    <li>cpuarch:x86_64</li>
    <li>side:light</li>
  </ul>
  <br><br>
  <h3>Minion Config</h3>
  <pre><code style="font-size: 150%">
  grains:
    roles:
      - webserver
      - memcache
    deployment: datacenter4
    side: dark
  </code></pre>
</section>

<section>
  <h2>Static groups</h2>
  <h3>Master Config</h3>
  <pre><code style="font-size: 150%">
  nodegroups:
    grandmasters: 'L@Yoda,Luke'
    knights: 'G@rank:JediKnight and *.dantooine.local'
  </code></pre>
</section>

<section>
  <h2>Remote Execution</h2>
  <pre><code style="font-size: 150%">
  salt '*' test.ping

  salt 'web[1-5]' nginx.signal reload

  salt -E 'django-(prod|test)' django.collectstatic

  salt -G 'os:MacOS' brew.install iterm2

  salt -L 'job1,job2,job3' cron.set_job root \* \* \* \* 1 /usr/local/weekly'
  </code></pre>
  <p>80 modules at the moment of this presentation, grows fast, easy to add.</p>
</section>

<section>
  <h2>State Enforcement</h2>
  <h3>SLS â€” <u>S</u>a<u>l</u>t <u>S</u>tack</h3>
  <pre><code>
  file_roots:
  base:
    - /srv/salt/
  kfc:
    - /home/dmedvinsky/src/kfc/kfc-server/deploy/
  </code></pre>
</section>

<section>
  <h2>State Enforcement</h2>
  <h2>Tree</h2>
  <img src="img/tree.png">
</section>

<section>
  <h2>State Enforcement</h2>
  <h3>Top file</h3>
  <img src="img/top.png">
</section>

<section>
  <h2>State File</h2>
  <pre><code style="font-size: 150%">
  libjpeg:
    pkg:
      - installed
      - names:
        - libjpeg8
        - libjpeg8-dev

  zlib:
    pkg:
      - installed
      - names:
        - zlib1g
        - zlib1g-dev
    file:
      - symlink
      - name: /usr/lib/libz.so
      - target: /usr/lib/x86_64-linux-gnu/libz.so
  </code></pre>
</section>

<section>
  <h2>State File</h2>
  <pre><code style="font-size: 150%">
  mysql-server:
    pkg:
      - installed
    service:
      - running
      - name: mysql
      - enable: True

  kfc_database:
    mysql_database:
      - present
      {% if 'kfc-prod' in grains['roles'] %}
      - name: kfc_prod
      {% else %}
      - name: kfc_test
      {% endif %}
      - require:
        - pkg: mysql-server
  </code></pre>
</section>

<section>
  <h2>State File</h2>
  <pre><code style="font-size: 150%"># nginx/init.sls:

    nginx:
      pkg:
        - installed
      service:
        - running
        - enable: True
  </code></pre>

  <pre><code style="font-size: 150%"># nginx/config.sls:

    include:
      - nginx

    extend:
      nginx:
        service:
          - watch:
            - file: conf

    conf:
      file:
        - managed
        - name: /etc/nginx/sites-available/kfc.conf
        - source: salt://nginx/site.conf
        - template: jinja
        - context:
          instance: prod
        - require:
          - pkg: nginx
  </code></pre>
</section>

<section>
  <h2>State File</h2>
  <pre><code>
  &lt;Include Declaration&gt;:
    - &lt;Module Reference&gt;
    - &lt;Module Reference&gt;

  &lt;Extend Declaration&gt;:
    &lt;ID Declaration&gt;:
      [&lt;overrides&gt;]

  &lt;ID Declaration&gt;:
    &lt;State Declaration&gt;:
      - &lt;Function&gt;:
      - &lt;Function Arg&gt;
      - &lt;Function Arg&gt;
      - &lt;Function Arg&gt;
      - &lt;Name&gt;: &lt;name&gt;
      - &lt;Requisite Declaration&gt;:
        - &lt;Requisite Reference&gt;
        - &lt;Requisite Reference&gt;

  &lt;ID Declaration&gt;:
    &lt;State Declaration&gt;.&lt;Function&gt;:
      - &lt;Function Arg&gt;
      - &lt;Function Arg&gt;
      - &lt;Function Arg&gt;
      - &lt;Names&gt;:
        - &lt;name&gt;
        - &lt;name&gt;
        - &lt;name&gt;
      - &lt;Requisite Declaration&gt;:
        - &lt;Requisite Reference&gt;
        - &lt;Requisite Reference&gt;
  </code></pre>
</section>

<section>
  <h1>Thanks</h1>
</section>

      </div>
    </div>
    <script src="../lib/reveal.js/plugin/highlight/highlight.js"></script>
    <script src="../lib/reveal.js/js/reveal.js"></script>
    <script>
        Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            loop: false,
            mouseWheel: false,
            rollingLinks: false,
            theme: 'neon', // default/neon
            transition: 'default' // default/cube/page/concave/linear(2d)
        });
        hljs.initHighlightingOnLoad();
    </script>
  </body>
</html>
