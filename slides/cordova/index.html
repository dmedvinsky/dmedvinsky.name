<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Introduction to Apache Cordova</title>
    <meta name="description" content="About Cordova for corporate junkies.">
    <meta name="author" content="Dmitry Medvinsky">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <link rel="stylesheet" href="../lib/reveal.js/css/reveal.css">
    <link rel="stylesheet" href="../lib/reveal.js/css/theme/sky.css">
    <link rel="stylesheet" href="../lib/reveal.js/lib/css/zenburn.css">
    <link rel="stylesheet" href="css/custom.css">
  </head>

  <body>
    <div class="reveal">
      <div class="slides">

<section>
  <h1>Apache Cordova</h1>
  <address class="author vcard">
    <p class="name">Dmitry Medvinsky</p>
    <p class="email"><a href="mailto:me@dmedvinsky.name">me@dmedvinsky.name</a></p>
  </address>
</section>

<section>
  <h2>Apache Cordova aka PhoneGap</h2>
  <blockquote>The only Open Source Mobile Framework that supports <b>7</b>
      platforms.</blockquote>
</section>

<section>
  <h2>How it works</h2>
  <img src="img/phonegap.png" alt="How it works">
</section>

<section>
  <h2 style="text-transform: none">iOS</h2>
  <img src="img/xcode-start.png" alt="Xcode new project">
</section>

<section>
  <h2 style="text-transform: none">iOS</h2>
  <img src="img/www-folder.png" alt="WWW folder">
</section>

<section>
  <h2>Android</h2>
  <ul>
    <li><pre><code>mkdir -p lib assets/www
cp cordova.jar libs/
cp xml res/
    </code></pre></li>

    <li><pre><code>import org.apache.cordova.*;</code></pre></li>
    <li><pre><code>public class MyActivity extends DroidGap</code></pre></li>
    <li><pre><code>super.loadUrl("file:///android_asset/www/index.html");</code></pre></li>

    <li>Add some perms.</li>
  </ul>
</section>

<section>
  <h2>Application code</h2>
  <pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    ...
    <strong>&lt;script src="cordova.js"&gt;&lt;/script&gt;</strong>
    &lt;script src="application.js"&gt;&lt;/script&gt;
  &lt;/head&gt;

  &lt;body onload="onLoad();"&gt;
    ...
    &lt;script&gt;
      var onLoad = function() {
        var onDeviceReady = function() {
          alert('Hello World');
        };
        <strong>document.addEventListener('deviceready',</strong>
          <strong>onDeviceReady, false);</strong>
        if (!window.cordova) onDeviceReady();
      };
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
</section>

<section>
  <h2>Project layout</h2>
  <pre><code>
    dmedvinsky at mc-air in ~/s/v/ios (ios/master=)
    &gt;&lt;((±&gt; git branch -r
      origin/android/master
      origin/app/master
      origin/ios/master
      origin/web/master

    dmedvinsky at mc-air in ~/s/v/ios (ios/master=)
    &gt;&lt;((±&gt; cat .gitmodules
    [submodule "webapp"]
        path = webapp
        url = server:/path/to/repo.git
  </code></pre>
</section>

<section>
  <h2>Makefile</h2>
  <pre><code>
    WEBAPP_ROOT = ./webapp
    WEBAPP_SRC = ${WEBAPP_ROOT}/public
    WEBAPP_DST = ./www

    assets:
        rm -rf ${WEBAPP_DST}/*
        cp -r ${WEBAPP_SRC}/* ${WEBAPP_DST}/
  </code></pre>
  <img src="img/buildstep.png" alt="Adding build step to project">
</section>

<section>
  <h2>Ant custom_rules.xml</h2>
  <pre><code>
    &lt;?xml version="1.0" encoding="UTF-8"?&gt;
    &lt;project name="VegasUndercover" default="help"&gt;
        &lt;target name="assets"&gt;
            &lt;copy todir="./assets/www/"&gt;
                &lt;fileset dir="./webapp/public/"&gt;
                    &lt;include name="**/*"/&gt;
                &lt;/fileset&gt;
            &lt;/copy&gt;
        &lt;/target&gt;
    &lt;/project&gt;
  </code></pre>
</section>

<section>
  <h2>Native code</h2>
  <h3>Built-ins</h3>
  <ul>
    <li>Accelerometer</li>
    <li>Camera</li>
    <li>Capture</li>
    <li>Compass</li>
    <li>Connection</li>
    <li>Contacts</li>
    <li>Device</li>
  </ul>
  <ul>
    <li>Events</li>
    <li>File</li>
    <li>Geolocation</li>
    <li>Media</li>
    <li>Notification</li>
    <li>Storage</li>
  </ul>
</section>

<section>
  <h2>Native code</h2>
  <h3>Plug-ins</h3>
  <img src="img/holyshitplugins.png" style="max-width: 100%" alt="A lot of plugins">
  <p>Can create your own!</p>
</section>

<section>
  <h2>Native code</h2>
  <h3>Example Plug-in</h3>
  <p><a href="https://github.com/dmedvinsky/cordova-startapp">github.com/dmedvinsky/cordova-startapp</a></p>
  <img src="img/startapp-tree.png" alt="StartApp plugin directory structure">
</section>

<section>
  <h2>Android</h2>
  <section>
    <pre><code>
// StartApp.java
package com.phonegap.plugins.startapp;

import org.apache.cordova.DroidGap;
import org.apache.cordova.api.Plugin;
import org.apache.cordova.api.PluginResult;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import android.content.ComponentName;
import android.content.Intent;

<strong>public class StartApp extends Plugin</strong>
    </code></pre>
  </section>
  <section>
    <pre><code>
public PluginResult execute(String action,
                            JSONArray args,
                            String callbackId)
{
    try {
        <strong>if (action.equals("startApp")) {</strong>
            if (args.length() != 1) {
                return new PluginResult(PluginResult.Status.INVALID_ACTION);
            }
            String component = args.getString(0);
            startActivity(component);
            return new PluginResult(PluginResult.Status.OK);
        }
        <strong>return new PluginResult(PluginResult.Status.INVALID_ACTION);</strong>
    } catch (JSONException e) {
        e.printStackTrace();
        return new PluginResult(PluginResult.Status.JSON_EXCEPTION);
    }
}
    </code></pre>
  </section>
  <section>
    <pre><code>
void startActivity(String component) {
    Intent i = new Intent("android.intent.action.MAIN");
    i.addCategory("android.intent.category.LAUNCHER");
    i.setComponent(ComponentName.unflattenFromString(component));
    this.ctx.startActivity(i);
}
    </code></pre>
  </section>
  <section>
    <pre><code>
var StartApp = function() { };

StartApp.prototype.start = function(params, win, fail) {
    win = win || function() {};
    fail = fail || function() {};
    var component = params.android;
    <strong>return cordova.exec(win, fail, 'startapp', 'startapp', [component]);</strong>
};

<strong>cordova.addconstructor(function() {
    cordova.addplugin('startapp', new startapp());
});</strong>
    </code></pre>
  </section>
</section>

<section>
  <h2 style="text-transform: none">iOS</h2>
  <section>
    <pre><code>
// StartApp.h:
#import &lt;Cordova/CDVPlugin.h&gt;


@interface StartApp : CDVPlugin
- (void) start:(NSMutableArray*)arguments withDict:(NSMutableDictionary*)options;
@end
    </code></pre>
  </section>
  <section>
    <pre><code>// StartApp.m:
#import "StartApp.h"

@implementation StartApp
- (void) start:(NSMutableArray*)arguments withDict:(NSMutableDictionary*)options
{
    CDVPluginResult *result;
    NSString *callbackId = [arguments pop];
    NSString *stringURL = [arguments objectAtIndex:0];
    [[UIApplication sharedApplication] openURL:[NSURL URLWithString:stringURL]];
    if (opened) {
        result = [CDVPluginResult resultWithStatus:CDVCommandStatus_OK messageAsString: @"URL opened"];
        [self writeJavascript:[result toSuccessCallbackString:callbackId]];
    } else {
        result = [CDVPluginResult resultWithStatus:CDVCommandStatus_ERROR messageAsString: @"Couldn't open URL"];
        [self writeJavascript:[result toErrorCallbackString:callbackId]];
    }
}
@end</code></pre>
  </section>
  <section>
    <pre><code>
var StartApp = function() { };

StartApp.prototype.start = function(params, win, fail) {
    win = win || function() {};
    fail = fail || function() {};
    var url = params.ios;
    <strong>return cordova.exec(success, fail, 'StartApp', 'start', [url]);</strong>
};

<strong>cordova.addConstructor(function() {
    cordova.addPlugin('startapp', new StartApp());
});</strong>
    </code></pre>
  </section>
</section>


<section>
  <h1>Thanks</h1>
</section>

      </div>
    </div>

    <script src="../lib/reveal.js/plugin/highlight/highlight.js"></script>
    <script src="../lib/reveal.js/js/reveal.js"></script>
    <script>
        Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            loop: false,
            mouseWheel: false,
            rollingLinks: false,
            theme: 'neon', // default/neon
            transition: 'default' // default/cube/page/concave/linear(2d)
        });
        hljs.initHighlightingOnLoad();
    </script>
  </body>
</html>
